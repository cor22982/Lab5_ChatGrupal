<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <script type="application/javascript">
       
       //elementos de enviar mensajes
       const text = document.createElement('textarea');
        document.body.append(text);
        const button = document.createElement('button');
        button.append('ENVIAR');
        document.body.append(button);


        //creacion elementos 
        const ul = document.createElement('ul');
        document.body.append(ul);
        
        //Funcion obtener mensajes
        const getMessages= async()=> {
            const response = await fetch('https://chat.tiburoncin.lat/messages');
            const messages = await response.json();
            console.log('mesages',messages);
           
            ul.innerHTML = '';
            messages.forEach((element) => {
                const li = document.createElement('li');
                li.append(`${element.username}: ${element.message}`);
                ul.append(li)
            });
        }

        //Funcion enviar mensajes
        const setMessages = async()=>{
            const body = {
                username: 'elMatius',
                message: text.value
            }
            const response = await fetch('https://chat.tiburoncin.lat/messages',
            {
                method: 'POST',
                body: JSON.stringify(body)
            })
            text.value = ''; // Limpiar el textarea después de enviar el mensaje
        }
       
        //enviar si se toca el boton
        button.addEventListener('click',setMessages);
        //enviar si se toca el enter
        // Función para enviar mensajes cuando se presiona "Enter"
        const enviarConEnter = (event) => {
            if (event.keyCode === 13) { // 13 es el código de la tecla "Enter"
                event.preventDefault(); // Evita que se inserte un salto de línea en el textarea
                setMessages(); // Llama a la función setMessages para enviar el mensaje
            }
        };

    // Agregar el event listener al textarea
        text.addEventListener('keydown', enviarConEnter);


        // Actualizar los mensajes cada 5 segundos (5000 milisegundos)
        setInterval(getMessages, 1000);
        
        // Cargar los mensajes al cargar la página
        getMessages();
    </script>
  </body>
</html>
