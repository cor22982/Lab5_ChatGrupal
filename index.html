<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <script type="application/javascript">
       
       //elementos de enviar mensajes
       const text = document.createElement('textarea');
        document.body.append(text);
        const button = document.createElement('button');
        button.append('ENVIAR');
        document.body.append(button);


        //creacion elementos 
        const ul = document.createElement('ul');
        document.body.append(ul);
        
        //Funcion obtener mensajes
        const getMessages= async()=> {
            const response = await fetch('https://chat.tiburoncin.lat/messages');
            const messages = await response.json();
            console.log('mesages',messages);
           
            ul.innerHTML = '';
            messages.forEach((element) => {
                const li = document.createElement('li');
                li.append(`${element.username}: ${element.message}`);
                ul.append(li)
            });
        }

        //Funcion enviar mensajes
        const setMessages = async()=>{
            const body = {
                username: 'elMatius',
                message: text.value
            }
            const response = await fetch('https://chat.tiburoncin.lat/messages',
            {
                method: 'POST',
                body: JSON.stringify(body)
            })
            text.value = ''; // Limpiar el textarea después de enviar el mensaje
        }
       

        button.addEventListener('click',setMessages);
        
        // Actualizar los mensajes cada 5 segundos (5000 milisegundos)
        setInterval(getMessages, 1000);
        
        // Cargar los mensajes al cargar la página
        getMessages();
    </script>
  </body>
</html>
